# 欠费用户催费标签分析系统

## 项目简介

本项目是一个基于机器学习的欠费用户催费标签体系构建系统，通过分析用户历史缴费数据，自动为用户分配催费等级标签，帮助优化催费策略，提升催费效率与客户满意度。

## 功能特点

- 🤖 **多种机器学习算法**：支持K-means聚类、XGBoost梯度提升决策树和DeepSeek AI三种分类方法
- 🔧 **多维特征工程**：11个核心特征全面评估用户风险（包括欠费金额、滞纳金、电费、缴费次数、合同容量、运行容量、欠费比例、滞纳金比例、缴费频率、容量利用率、欠费严重程度）
- 📊 **丰富数据可视化**：饼图、柱状图、特征统计等多维度展示
- 🏷️ **智能标签体系**：轻度提醒、中度催缴、重度追讨三级分类
- 🎯 **业务规则融合**：结合机器学习和业务经验的混合决策
- 🌐 **现代Web界面**：响应式设计，支持移动端访问
- 📈 **实时统计分析**：动态展示用户分布和特征统计
- 🔍 **详细特征展示**：显示每个用户的关键风险指标
- 🔄 **算法比较功能**：支持比较不同分类方法的结果差异
- 🧠 **AI智能分析**：集成DeepSeek AI进行智能催费标签预测
- 📋 **历史数据管理**：支持查看和管理历史分类结果
- 🔗 **RESTful API**：提供完整的API接口支持

## 技术栈

### 后端
- **Python 3.8+**
- **Flask 2.3.3**：Web框架
- **pandas 2.1.1**：数据处理
- **scikit-learn 1.3.0**：机器学习（K-means聚类）
- **XGBoost 1.7.6**：梯度提升决策树
- **requests 2.31.0**：HTTP请求库（DeepSeek API调用）
- **openpyxl 3.1.2**：Excel文件处理
- **numpy 1.24.3**：数值计算

### 前端
- **Bootstrap 5**：UI框架
- **ECharts**：图表库
- **原生JavaScript**：交互逻辑

## 项目结构

```
项目/
├── app.py                          # Flask Web应用主文件，集成三种分类方法的API
├── requirements.txt                # Python依赖包列表
├── README.md                       # 项目说明文档
├── 欠费用户历史数据.xlsx            # 原始数据文件
├── k_means用户催费标签结果.xlsx     # K-means生成的标签结果
├── XGBoost用户催费标签结果.xlsx     # XGBoost生成的标签结果
├── DeepSeek用户催费标签结果.xlsx    # DeepSeek生成的标签结果
├── k_means.py                      # K-means聚类算法实现
├── xgboost_classifier.py           # XGBoost分类器实现
├── deepseek_classifier.py          # DeepSeek AI分类器实现
└── templates/                      # HTML模板目录
   └── index.html                  # 主页面模板，响应式设计
```

## 安装与运行

### 1. 环境准备

确保已安装Python 3.8或更高版本。

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

### 3. 配置DeepSeek API（可选）

如需使用DeepSeek AI功能，请：
1. 获取DeepSeek API密钥
2. 在环境变量中设置API密钥
3. 确保网络连接正常

### 4. 运行应用

```bash
python app.py
```

### 5. 访问界面

打开浏览器访问：`http://localhost:5000`

## 使用说明

### 1. 数据准备

确保项目目录中存在 `欠费用户历史数据.xlsx` 文件，包含以下列：
- **用户编号**：用户唯一标识
- **电费**：基础电费金额
- **滞纳金**：逾期产生的滞纳金
- **欠费金额**：当前欠费总额
- **电量**：用电量数据
- **合同容量**：合同约定容量
- **运行容量**：实际运行容量
- **缴费次数**：历史缴费次数

### 2. 生成标签

1. 选择分类方法（K-means、XGBoost或DeepSeek AI）
2. 点击「生成催费标签」按钮
3. 系统将自动处理数据并生成标签
4. 生成完成后自动显示结果

### 3. 查看结果

- **统计概览**：显示总用户数和各等级用户数量及占比
- **特征统计**：展示平均欠费金额、欠费比例、滞纳金比例、缴费频率、严重程度等关键指标
- **图表展示**：饼图和柱状图直观展示标签分布
- **特征重要性**：XGBoost模式下显示各特征对分类的重要性
- **详细列表**：显示用户的完整特征信息和标签详情
- **操作建议**：为每个等级提供具体的催费策略建议

### 4. 比较分类方法

1. 点击「比较分类方法」按钮
2. 系统将展示三种方法的结果对比
3. 查看一致性分析和不一致样本示例

## 算法说明

### 增强特征工程

1. **基础特征**：
   - **平均欠费金额**：基于多个数值列的综合平均值
   - **总延迟次数**：基于欠费金额大于0的统计

2. **业务特征**：
   - **欠费比例**：欠费金额占电费的比例，反映欠费严重程度
   - **滞纳金比例**：滞纳金占欠费金额的比例，体现逾期时长
   - **缴费频率**：缴费次数与总期数的比例，评估缴费习惯
   - **容量利用率**：运行容量与合同容量的比例，反映用电稳定性

3. **综合指标**：
   - **欠费严重程度**：多特征加权综合评分，全面评估风险等级

### 三种分类方法对比

| 特性 | K-means | XGBoost | DeepSeek AI |
|------|---------|---------|-------------|
| 算法类型 | 无监督聚类 | 有监督分类 | AI智能分析 |
| 计算效率 | 高 | 中等 | 中等 |
| 分类精度 | 中等 | 高 | 很高 |
| 特征重要性 | 不提供 | 提供详细分析 | 智能分析 |
| 对异常值敏感度 | 高 | 低 | 很低 |
| 可解释性 | 直观 | 复杂 | 智能解释 |
| 参数调优 | 简单 | 复杂 | 自动优化 |
| 业务适应性 | 一般 | 好 | 很好 |

### K-means聚类算法

- **多特征KMeans聚类**：基于7个特征的高维聚类分析
- **自适应聚类数选择**：通过轮廓系数自动选择最佳聚类数（3-10）
- **数据标准化**：StandardScaler确保各特征权重公平
- **稳定性保证**：设置随机种子确保结果可重现

### XGBoost分类算法

- **梯度提升决策树**：基于决策树的集成学习算法
- **初始标签生成**：使用K-means生成初始标签作为训练数据
- **特征重要性分析**：自动计算并展示各特征对分类结果的重要性
- **高精度分类**：通过多轮迭代提高分类准确率
- **鲁棒性**：对异常值和缺失值具有较强的抵抗力

### DeepSeek AI分类算法

- **智能分析**：基于大语言模型的智能催费标签预测
- **上下文理解**：深度理解用户缴费行为模式
- **自适应学习**：根据数据特征自动调整分析策略
- **业务洞察**：提供深度的业务分析和建议
- **高准确性**：结合多维度信息进行精准分类

### 智能标签映射

**机器学习 + 业务规则 + AI智能分析三重决策**：

1. **初步分类**：基于选择的算法进行初始分类
2. **业务规则调整**：
   - 高欠费金额用户（>90%分位数）→ 重度追讨
   - 高滞纳金比例用户（>15%）→ 升级处理
   - 低缴费频率用户（<40%）→ 升级关注
3. **AI智能优化**：DeepSeek AI提供智能化的标签优化建议

**最终标签含义**：
- **轻度提醒**：欠费情况较轻，建议友好提醒
- **中度催缴**：欠费情况中等，需要电话催缴
- **重度追讨**：欠费情况严重，需要强制措施

## 催费策略建议

| 标签等级 | 催费策略 | 具体措施 |
|---------|---------|----------|
| 轻度提醒 | 温和提醒 | 发送友好提醒短信，提供便民缴费渠道 | 
| 中度催缴 | 主动催缴 | 电话催缴，了解欠费原因，提供分期方案 | 
| 重度追讨 | 强制措施 | 上门催收，法律途径，停电措施 | 

## 文件说明

## API接口说明

### 主要API端点

1. **POST /generate_labels**
   - 功能：生成催费标签
   - 参数：`method`（分类方法：kmeans/xgboost/deepseek）
   - 返回：分类结果和统计信息

2. **GET /get_history**
   - 功能：获取历史分类数据
   - 参数：`method`（分类方法）
   - 返回：历史分类结果

3. **POST /compare_methods**
   - 功能：比较不同分类方法的结果
   - 返回：三种方法的对比分析

### 文件说明

### 核心文件

- **app.py**：Flask Web应用主文件，提供完整的Web服务和API接口
- **k_means.py**：K-means聚类算法实现，包含数据预处理、聚类分析和标签映射
- **xgboost_classifier.py**：XGBoost分类器实现，包含特征工程、模型训练和预测
- **deepseek_classifier.py**：DeepSeek AI分类器实现，集成大语言模型进行智能分析
- **templates/index.html**：主页面模板，支持三种分类方法和结果可视化

### 数据文件

- **欠费用户历史数据.xlsx**：原始用户缴费数据
- **k_means用户催费标签结果.xlsx**：K-means方法生成的标签结果
- **XGBoost用户催费标签结果.xlsx**：XGBoost方法生成的标签结果
- **DeepSeek用户催费标签结果.xlsx**：DeepSeek AI方法生成的标签结果

## 扩展功能

### 已实现功能

1. **多算法支持**：K-means、XGBoost、DeepSeek AI三种方法
2. **方法比较**：一致性分析和不一致样本展示
3. **特征重要性**：XGBoost提供详细的特征重要性分析
4. **AI智能分析**：DeepSeek提供智能化的分类和建议
5. **响应式界面**：支持移动端访问

### 可能的改进方向

1. **更多AI模型**：集成更多大语言模型进行对比分析
2. **时间序列分析**：考虑用户缴费行为的时间模式
3. **用户画像**：深入分析不同类型用户的特征
4. **实时处理**：支持实时数据流处理
5. **导出功能**：支持多种格式的结果导出
6. **用户管理**：添加用户权限和角色管理
7. **模型融合**：结合多种算法的优势进行集成学习

## 注意事项

1. 确保Excel文件格式正确且未损坏
2. 数据量大时可能需要较长处理时间
3. DeepSeek AI功能需要网络连接和API密钥
4. 建议在生产环境中使用专业的Web服务器（如Gunicorn）
5. 定期备份重要数据文件
6. 注意API调用频率限制
7. 如遇到"Bad magic number for central directory"错误，请检查Excel文件是否损坏

## 故障排除

### 常见问题

1. **"Bad magic number for central directory"错误**
   - 原因：Excel文件损坏
   - 解决方案：替换为有效的Excel文件

2. **模块导入错误**
   - 原因：缺少必要的Python包
   - 解决方案：运行 `pip install -r requirements.txt`

3. **DeepSeek API调用失败**
   - 原因：网络连接问题或API密钥无效
   - 解决方案：检查网络连接和API密钥配置

